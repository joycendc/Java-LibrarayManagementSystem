package library;

import java.awt.Color;
import java.awt.Toolkit;
import java.awt.datatransfer.Clipboard;
import java.awt.datatransfer.StringSelection;
import java.awt.event.WindowEvent;
import java.awt.event.WindowListener;
import javax.swing.BorderFactory;
import javax.swing.JOptionPane;

public class AddBook extends javax.swing.JFrame {

    DBConnect db = new DBConnect();
    Color ex;
    boolean addbutt = false;
    boolean updbutt = false;
    public AddBook() {
        getRootPane().setBorder(BorderFactory.createLineBorder(new java.awt.Color(0, 204, 0), 3));
        init();
        upd.setVisible(false);
        del.setVisible(false);
        ex = new Color(0, 204, 0);
        listen(0);
        this.setTitle("Add Book");
        category.setBackground(new Color(0,204,0));
        clip.setVisible(false);
    }
    
    public AddBook(Book book) {
        getRootPane().setBorder(BorderFactory.createLineBorder(new java.awt.Color(255, 153, 0), 3));
        init();
        isbn.setText(book.getIsbn());
        title.setText(book.getTitle());
        category.setSelectedItem(book.getCategory());
        author.setText(book.getAuthor());
        publisher.setText(book.getPublisher());
        year.setText(book.getYear());
        copy.setText(book.getCopy());
        add.setVisible(false);
        isbn.setEnabled(false);
        ex = new Color(255, 153, 0);
        category.removeItemAt(0);
        listen(1);
        this.setTitle("Update Book");
        category.setBackground(new Color(255, 153, 0));
    }
    void init(){
        initComponents();
        category.setModel(db.setCombo(false, "SELECT * FROM `category_details`;"));
    }
    void listen(int who){
        this.addWindowListener(new WindowListener(){
            @Override
            public void windowOpened(WindowEvent e) {}
            @Override
            public void windowClosing(WindowEvent e) {}
            @Override
            public void windowClosed(WindowEvent e) {}
            @Override
            public void windowIconified(WindowEvent e) {}
            @Override
            public void windowDeiconified(WindowEvent e) {}
            @Override
            public void windowActivated(WindowEvent e) {}
            
            @Override
            public void windowDeactivated(WindowEvent e) {
                if(who == 0 && !addbutt) dispose();
                else if(who == 1 && !updbutt) dispose();
            }
            
        });
    }
    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel1 = new javax.swing.JPanel();
        jLabel1 = new javax.swing.JLabel();
        isbn = new javax.swing.JTextField();
        jLabel2 = new javax.swing.JLabel();
        title = new javax.swing.JTextField();
        jLabel3 = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        author = new javax.swing.JTextField();
        jLabel5 = new javax.swing.JLabel();
        publisher = new javax.swing.JTextField();
        jLabel6 = new javax.swing.JLabel();
        year = new javax.swing.JTextField();
        jLabel7 = new javax.swing.JLabel();
        copy = new javax.swing.JTextField();
        add = new javax.swing.JButton();
        exit = new javax.swing.JButton();
        category = new javax.swing.JComboBox<>();
        upd = new javax.swing.JButton();
        del = new javax.swing.JButton();
        clip = new javax.swing.JButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setUndecorated(true);

        jPanel1.setBackground(new java.awt.Color(255, 255, 255));

        jLabel1.setText("ISBN");

        isbn.setBackground(new java.awt.Color(249, 239, 255));
        isbn.setBorder(BorderFactory.createEmptyBorder(5,5,5,5));
        isbn.setDisabledTextColor(new java.awt.Color(0, 0, 0));

        jLabel2.setText("Title");

        title.setBackground(new java.awt.Color(249, 239, 255));
        title.setBorder(BorderFactory.createEmptyBorder(5,5,5,5));

        jLabel3.setText("Category");

        jLabel4.setText("Author");

        author.setBackground(new java.awt.Color(249, 239, 255));
        author.setBorder(BorderFactory.createEmptyBorder(5,5,5,5));

        jLabel5.setText("Publisher");

        publisher.setBackground(new java.awt.Color(249, 239, 255));
        publisher.setBorder(BorderFactory.createEmptyBorder(5,5,5,5));

        jLabel6.setText("Publish Year");

        year.setBackground(new java.awt.Color(249, 239, 255));
        year.setBorder(BorderFactory.createEmptyBorder(5,5,5,5));

        jLabel7.setText("Copies");

        copy.setBackground(new java.awt.Color(249, 239, 255));
        copy.setBorder(BorderFactory.createEmptyBorder(5,5,5,5));

        add.setBackground(new java.awt.Color(0, 204, 0));
        add.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        add.setForeground(new java.awt.Color(255, 255, 255));
        add.setText("Add Book");
        add.setFocusPainted(false);
        add.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                addActionPerformed(evt);
            }
        });

        exit.setBackground(new java.awt.Color(255, 255, 255));
        exit.setFont(new java.awt.Font("Tahoma", 1, 12)); // NOI18N
        exit.setText("x");
        exit.setBorderPainted(false);
        exit.setFocusable(false);
        exit.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        exit.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseEntered(java.awt.event.MouseEvent evt) {
                exitMouseEntered(evt);
            }
            public void mouseExited(java.awt.event.MouseEvent evt) {
                exitMouseExited(evt);
            }
        });
        exit.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                exitActionPerformed(evt);
            }
        });

        category.setBackground(new java.awt.Color(0, 204, 0));
        category.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        category.setForeground(new java.awt.Color(255, 255, 255));
        category.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] {}));

        upd.setBackground(new java.awt.Color(255, 153, 0));
        upd.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        upd.setForeground(new java.awt.Color(255, 255, 255));
        upd.setText("Update Book");
        upd.setFocusPainted(false);
        upd.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                updActionPerformed(evt);
            }
        });

        del.setBackground(new java.awt.Color(255, 51, 51));
        del.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        del.setForeground(new java.awt.Color(255, 255, 255));
        del.setText("Delete Book");
        del.setFocusPainted(false);
        del.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                delActionPerformed(evt);
            }
        });

        clip.setBackground(new java.awt.Color(255, 255, 255));
        clip.setForeground(new java.awt.Color(0, 0, 0));
        clip.setText("Copy");
        clip.setBorder(null);
        clip.setFocusPainted(false);
        clip.setFocusable(false);
        clip.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                clipActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(exit, javax.swing.GroupLayout.Alignment.TRAILING)
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addGroup(jPanel1Layout.createSequentialGroup()
                                .addComponent(upd, javax.swing.GroupLayout.PREFERRED_SIZE, 115, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(del, javax.swing.GroupLayout.PREFERRED_SIZE, 122, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addComponent(add, javax.swing.GroupLayout.PREFERRED_SIZE, 156, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addGroup(jPanel1Layout.createSequentialGroup()
                                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                                    .addComponent(jLabel1)
                                    .addComponent(jLabel2)
                                    .addComponent(jLabel4)
                                    .addComponent(jLabel3)
                                    .addComponent(jLabel5)
                                    .addComponent(jLabel6)
                                    .addComponent(jLabel7))
                                .addGap(26, 26, 26)
                                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                                    .addGroup(jPanel1Layout.createSequentialGroup()
                                        .addComponent(isbn, javax.swing.GroupLayout.PREFERRED_SIZE, 127, javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                        .addComponent(clip, javax.swing.GroupLayout.PREFERRED_SIZE, 32, javax.swing.GroupLayout.PREFERRED_SIZE))
                                    .addComponent(title)
                                    .addComponent(category, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                    .addComponent(author)
                                    .addComponent(publisher)
                                    .addComponent(year)
                                    .addComponent(copy))))
                        .addGap(37, 37, 37))))
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addComponent(exit, javax.swing.GroupLayout.PREFERRED_SIZE, 35, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(36, 36, 36)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(isbn, javax.swing.GroupLayout.PREFERRED_SIZE, 28, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel1)
                    .addComponent(clip, javax.swing.GroupLayout.PREFERRED_SIZE, 28, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(title, javax.swing.GroupLayout.PREFERRED_SIZE, 26, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel2))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(category, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel3))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(author, javax.swing.GroupLayout.PREFERRED_SIZE, 26, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel4))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(publisher, javax.swing.GroupLayout.PREFERRED_SIZE, 28, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel5))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(year, javax.swing.GroupLayout.PREFERRED_SIZE, 28, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel6))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(copy, javax.swing.GroupLayout.PREFERRED_SIZE, 28, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel7))
                .addGap(18, 18, 18)
                .addComponent(add, javax.swing.GroupLayout.PREFERRED_SIZE, 41, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 0, 0)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(del, javax.swing.GroupLayout.PREFERRED_SIZE, 40, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(upd, javax.swing.GroupLayout.PREFERRED_SIZE, 40, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(0, 0, 0))
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );

        pack();
        setLocationRelativeTo(null);
    }// </editor-fold>//GEN-END:initComponents

    private void exitMouseEntered(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_exitMouseEntered
        exit.setBackground(ex);
        exit.setForeground(new java.awt.Color(255, 255, 255));
    }//GEN-LAST:event_exitMouseEntered

    private void exitMouseExited(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_exitMouseExited
        exit.setBackground(new java.awt.Color(255, 255, 255));
        exit.setForeground(new java.awt.Color(0, 0, 0));
    }//GEN-LAST:event_exitMouseExited
    
    
    private void exitActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_exitActionPerformed
        this.dispose();
    }//GEN-LAST:event_exitActionPerformed
    
    String isFieldsEmpty(){  
        if(isbn.getText().trim().equals("")) 
            return "Please enter isbn";
        if(title.getText().trim().equals("")) 
            return "Please enter book title";
        if(category.getSelectedItem().toString().equals("--  SELECT  --"))  
            return "Please select category";
        if(author.getText().trim().equals("")) 
            return "Please enter the author";
        if(publisher.getText().trim().equals("")) 
            return "Please enter the publisher";
        if(year.getText().trim().equals("")) 
            return "Please enter publication year";
        if(copy.getText().trim().equals("")) 
            return "Please enter book copies";
         else 
            return "NO";    
    }
    
    private void addActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_addActionPerformed
        Book book = new Book();
        book.setIsbn(isbn.getText());
        book.setTitle(title.getText());
        book.setCategory(category.getSelectedItem().toString());
        book.setAuthor(author.getText());
        book.setPublisher(publisher.getText());
        book.setYear(year.getText());
        book.setCopy(copy.getText());
        
        addbutt = true;
        if(!isFieldsEmpty().equals("NO")){  
            JOptionPane.showMessageDialog(null, isFieldsEmpty(), "Warning !",2);         
            addbutt = false;
        }else if(db.insertBook(book)){
            this.dispose();
            JOptionPane.showMessageDialog(null, "Book Inserted !", "Success",2);
        }
    }//GEN-LAST:event_addActionPerformed

    private void updActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_updActionPerformed
        Book book = new Book();
        book.setIsbn(isbn.getText());
        book.setTitle(title.getText());
        book.setCategory(category.getSelectedItem().toString());
        book.setAuthor(author.getText());
        book.setPublisher(publisher.getText());
        book.setYear(year.getText());
        book.setCopy(copy.getText());
        
        updbutt = true;
        if(!isFieldsEmpty().equals("NO")){  
            JOptionPane.showMessageDialog(null, isFieldsEmpty(), "Warning !",2);         
            addbutt = false;
        }else if(db.updateBook(book)){
            this.dispose();
            JOptionPane.showMessageDialog(null, "Book Updated !", "Success",2);
        }
    }//GEN-LAST:event_updActionPerformed

    private void delActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_delActionPerformed
        int log = JOptionPane.showConfirmDialog(null,"Are you sure to delete " + title.getText() + " ?","Delete",0,2);
        if(log==0){  
            db.deleteBook(isbn.getText()); 
            JOptionPane.showMessageDialog(null, "Book Deleted !", "Success",2);
            this.dispose();
        }
          
    }//GEN-LAST:event_delActionPerformed

    private void clipActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_clipActionPerformed
        Clipboard c = Toolkit.getDefaultToolkit().getSystemClipboard();
        c.setContents(new StringSelection(isbn.getText()), null);
      
        this.dispose();
    }//GEN-LAST:event_clipActionPerformed

    public static void main(String args[]) {
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new AddBook().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton add;
    private javax.swing.JTextField author;
    private javax.swing.JComboBox<String> category;
    private javax.swing.JButton clip;
    private javax.swing.JTextField copy;
    private javax.swing.JButton del;
    private javax.swing.JButton exit;
    private javax.swing.JTextField isbn;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JTextField publisher;
    private javax.swing.JTextField title;
    private javax.swing.JButton upd;
    private javax.swing.JTextField year;
    // End of variables declaration//GEN-END:variables
}